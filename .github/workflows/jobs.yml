---
# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run

on:  # yamllint disable-line rule:truthy
  push:
    branches:
      - '*'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  lint_markdown:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Lint changelog file
        uses: avto-dev/markdown-lint@v1.5.0
        with:
          rules: '/lint/rules/changelog.js'
          config: '/lint/config/changelog.yml'
          args: './CHANGELOG.md'

      - name: Lint other markdown files
        uses: avto-dev/markdown-lint@v1.5.0
        with:
          config: './.github/workflows/config/markdown_lint_config.yml'
          args: './*.md'
          ignore: './CHANGELOG.md'

  lint_yaml:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Yamllint Github Action
        uses: karancode/yamllint-github-action@v2.0.0
        with:
          yamllint_strict: true
          yamllint_comment: true

  install-tools:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Get latest docker-compose
        run: wget "https://github.com/docker/compose/releases/download/v2.0.1/docker-compose-linux-x86_64"  # yamllint disable-line rule:line-length
      - name: Install latest docker-compose
        run: |
          uname -a
          chmod a+x ./docker-compose-linux-x86_64
          mv ./docker-compose-linux-x86_64 /usr/local/bin/docker-compose
      - name: Version information
        run: |
          which docker
          docker --version
          which docker-compose
          docker-compose --version

  verify-tools:
    runs-on: ubuntu-latest
    needs:
      - install-tools
    steps:
      - name: verify docker
        run: docker --version | grep "20.10"
      - name: verify docker-compose
        run: docker-compose --version && (docker-compose --version | grep "v2.0.1")  # yamllint disable-line rule:line-length
